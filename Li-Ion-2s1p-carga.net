* C:\Users\gerva\Documents\GitHub\LAB-FINAL-CL\Li-Ion-2s1p-carga.asc
* Generated by LTspice 24.1.8 for Windows.
I1 0 N002 1
X§X4 N001 N003 soc2 Li-Ion params: Isoc=0.01975
R1 N002 N001 0.1
X§X3 N003 N004 soc1 Li-Ion params: Isoc=0.022
R2 0 N004 0.1

* block symbol definitions
.subckt Li-Ion cell+ cell- V.soc
R.self_discharge V.soc 0 R=R.sd()
C.capacity V.soc 0 Q=C.eff()*x
B§I.batt V.soc 0 I=-I(V.batt)
R.series N002 N001 R=R.s(soc())
R.trans_short N003 N002 R=R.ts(soc())
R.trans_long cell+ N003 R=R.tl(soc())
B§V.batt N001 cell- V=V.oc(soc())
C.trans_short N003 N002 Q=C.ts(soc())*x
C.trans_long cell+ N003 Q=C.tl(soc())*x
R1 cell- 0 {1/GMIN}
.func C.eff()=3600*{Capacity.Ah}
.func soc()=V(V.soc)
.func V.oc(SOC)=(-1.031*exp(-35*SOC))+{Nominal.V}+(0.2156*SOC)+(-0.1178*(SOC**2))+(.3201*POW(SOC,3))
.func R.s(SOC)=(0.1562*exp(-24.37*SOC))+0.07446
.func R.ts(SOC)=(0.3208*exp(-29.14*SOC))+0.04669
.func C.ts(SOC)=(-752.9*exp(-13.51*SOC))+703.6
.func R.tl(SOC)=(6.603*exp(-155.2*SOC))+0.04984
.func C.tl(SOC)=(-6056*exp(-27.12*SOC))+4475
.param Nominal.V=3.685V Capacity.Ah=2.2 SelfDischarge.R=0 Cycle.count=1 Isoc=0.02
.func R.sd()=if({SelfDischarge.R}<1000,1/GMIN,abs({SelfDischarge.R}))
.ic V(V.soc)={Isoc}
.ends Li-Ion

.options gmin=1e-12 abstol=1n reltol=0.1
.tran 7.7641723K
.backanno
.end
