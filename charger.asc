Version 4.1
SHEET 1 3156 680
WIRE -416 -944 -416 -960
WIRE -400 -944 -416 -944
WIRE -400 -912 -416 -912
WIRE -624 -896 -688 -896
WIRE -624 -880 -624 -896
WIRE -608 -880 -624 -880
WIRE -416 -864 -416 -912
WIRE -608 -848 -624 -848
WIRE 608 -816 432 -816
WIRE -624 -800 -624 -848
WIRE -624 -800 -688 -800
WIRE 608 -784 608 -816
WIRE 784 -784 608 -784
WIRE 432 -768 432 -816
WIRE 608 -768 608 -784
WIRE 2176 -640 2176 -656
WIRE 2192 -640 2176 -640
WIRE 1664 -608 1504 -608
WIRE 2192 -608 2176 -608
WIRE 1760 -592 1728 -592
WIRE 1792 -592 1760 -592
WIRE 608 -576 608 -688
WIRE 1664 -576 1632 -576
WIRE 608 -560 608 -576
WIRE 2176 -560 2176 -608
WIRE 768 -544 608 -544
WIRE 112 -528 -64 -528
WIRE 288 -528 192 -528
WIRE 304 -528 288 -528
WIRE 432 -528 432 -688
WIRE 432 -528 384 -528
WIRE -656 -496 -816 -496
WIRE -560 -496 -576 -496
WIRE -384 -496 -448 -496
WIRE -256 -496 -320 -496
WIRE -144 -496 -256 -496
WIRE -64 -496 -64 -528
WIRE -64 -496 -144 -496
WIRE -560 -464 -560 -496
WIRE -448 -464 -448 -496
WIRE -144 -464 -144 -496
WIRE 112 -464 112 -480
WIRE 432 -464 432 -528
WIRE -816 -448 -816 -496
WIRE 288 -448 288 -528
WIRE 768 -448 704 -448
WIRE 800 -448 768 -448
WIRE -256 -432 -256 -496
WIRE 560 -432 560 -496
WIRE 608 -432 608 -480
WIRE 704 -432 704 -448
WIRE 704 -432 608 -432
WIRE 768 -416 768 -448
WIRE 1632 -416 1632 -576
WIRE 1664 -416 1632 -416
WIRE 1744 -416 1728 -416
WIRE 1760 -416 1760 -592
WIRE 1760 -416 1744 -416
WIRE -384 -368 -384 -432
WIRE -816 -336 -816 -368
WIRE -624 -336 -816 -336
WIRE -560 -336 -560 -384
WIRE -560 -336 -624 -336
WIRE -448 -320 -448 -384
WIRE -320 -320 -320 -432
WIRE -320 -320 -448 -320
WIRE -64 -320 -64 -496
WIRE 288 -320 288 -384
WIRE 288 -320 -64 -320
WIRE 432 -320 432 -400
WIRE 432 -320 288 -320
WIRE 512 -320 432 -320
WIRE 608 -320 608 -352
WIRE 608 -320 512 -320
WIRE 768 -320 768 -352
WIRE 768 -320 608 -320
WIRE 1488 -288 1392 -288
WIRE 1600 -288 1568 -288
WIRE 1968 -240 1792 -240
WIRE 2112 -240 2048 -240
WIRE 2128 -240 2112 -240
WIRE 2480 -224 2272 -224
WIRE 2272 -208 2272 -224
WIRE 2800 -192 2672 -192
WIRE 1392 -160 1392 -288
WIRE 1472 -160 1392 -160
WIRE 1600 -160 1600 -288
WIRE 1600 -160 1536 -160
WIRE 1792 -128 1792 -240
WIRE 2208 -112 2208 -208
WIRE 2336 -112 2208 -112
WIRE 1968 -96 1968 -240
WIRE 1984 -96 1968 -96
WIRE 2480 -96 2480 -224
WIRE 2480 -96 2400 -96
WIRE 2672 -96 2672 -192
WIRE 2672 -96 2560 -96
WIRE 1056 -80 992 -80
WIRE 2128 -80 2128 -240
WIRE 2128 -80 2048 -80
WIRE 2208 -80 2208 -112
WIRE 2336 -80 2320 -80
WIRE 2672 -80 2672 -96
WIRE 2688 -80 2672 -80
WIRE 1056 -64 1056 -80
WIRE 1072 -64 1056 -64
WIRE 1984 -64 1968 -64
WIRE 2880 -64 2880 -192
WIRE 2880 -64 2752 -64
WIRE 1232 -48 1136 -48
WIRE 1392 -48 1392 -160
WIRE 1392 -48 1312 -48
WIRE 1424 -48 1392 -48
WIRE 2688 -48 2672 -48
WIRE 1072 -32 1056 -32
WIRE 1600 -32 1600 -160
WIRE 1600 -32 1488 -32
WIRE 2320 -32 2320 -80
WIRE 1424 -16 1392 -16
WIRE 1968 -16 1968 -64
WIRE 2592 0 2544 0
WIRE 2672 0 2672 -48
WIRE 976 16 912 16
WIRE 1056 16 1056 -32
WIRE 2544 32 2544 0
WIRE 1392 48 1392 -16
WIRE 1792 64 1792 -48
WIRE 2480 64 2480 -96
WIRE 2480 64 1792 64
WIRE 1504 80 1408 80
WIRE 1616 80 1584 80
WIRE 2672 96 2672 0
WIRE 1408 208 1408 80
WIRE 1488 208 1408 208
WIRE 1616 208 1616 80
WIRE 1616 208 1552 208
WIRE 1040 288 976 288
WIRE 1040 304 1040 288
WIRE 1056 304 1040 304
WIRE 1216 320 1120 320
WIRE 1408 320 1408 208
WIRE 1408 320 1296 320
WIRE 1440 320 1408 320
WIRE 1056 336 1040 336
WIRE 1616 336 1616 208
WIRE 1616 336 1504 336
WIRE 1440 352 1408 352
WIRE 960 384 896 384
WIRE 1040 384 1040 336
WIRE 1408 416 1408 352
FLAG 512 -320 0
FLAG 800 -448 Vshunt
IOPIN 800 -448 Out
FLAG 368 384 0
FLAG 496 384 0
FLAG 368 304 Vcc+
FLAG 496 304 Vee-
FLAG 1104 -80 Vcc+
FLAG 1104 -16 Vee-
FLAG 1456 0 0
FLAG 1392 48 0
FLAG 1456 -64 Vcc+
FLAG 2016 -48 Vcc+
FLAG 2016 -112 Vee-
FLAG 2368 -128 Vcc+
FLAG 2368 -64 Vee-
FLAG 2720 -96 Vcc+
FLAG 2720 -32 Vee-
FLAG 2320 -32 0
FLAG 1968 -16 0
FLAG 2544 112 0
FLAG 2880 -64 Tri
IOPIN 2880 -64 Out
FLAG 2672 176 0
FLAG 2112 -240 v3
FLAG 1600 -32 vctrl
IOPIN 1600 -32 Out
FLAG 560 -432 soc1
FLAG 896 384 Vshunt
IOPIN 896 384 In
FLAG 1088 288 Vcc+
FLAG 1088 352 Vee-
FLAG 816 288 0
FLAG 1472 368 0
FLAG 1408 416 0
FLAG 1472 304 Vcc+
FLAG 1616 336 Ictrl
IOPIN 1616 336 Out
FLAG 560 -704 soc2
FLAG 2224 -656 Vcc+
FLAG 2224 -592 Vee-
FLAG 2176 -656 Tri
IOPIN 2176 -656 In
FLAG 2256 -624 PWM
IOPIN 2256 -624 Out
FLAG 176 -576 0
FLAG 432 -528 Vm
IOPIN 432 -528 Out
FLAG 608 -576 Vc1
IOPIN 608 -576 Out
FLAG 608 -816 Vtot
IOPIN 608 -816 Out
FLAG 128 -576 PWM
IOPIN 128 -576 In
FLAG -624 -336 0
FLAG -384 -368 0
FLAG -256 -368 0
FLAG -144 -384 0
FLAG 1696 -560 0
FLAG 1696 -624 Vcc+
FLAG 1792 -592 control
IOPIN 1792 -592 Out
FLAG 256 384 0
FLAG 256 304 Vcv
IOPIN 256 304 Out
FLAG 912 -80 Vcv
IOPIN 912 -80 In
FLAG 1504 -608 Vcv
IOPIN 1504 -608 In
FLAG 912 16 Vm
IOPIN 912 16 In
FLAG 1552 -576 Vm
IOPIN 1552 -576 In
FLAG 1936 -496 Vpwm
IOPIN 1936 -496 Out
FLAG 1936 -416 0
FLAG 2176 -560 Vpwm
IOPIN 2176 -560 In
FLAG 384 -752 0
FLAG -688 -800 onctrl
IOPIN -688 -800 In
FLAG -576 -896 Vcc+
FLAG -576 -832 Vee-
FLAG -768 -896 0
FLAG -544 -864 on
IOPIN -544 -864 Out
FLAG 384 -704 on
IOPIN 384 -704 In
FLAG 928 -544 0
FLAG 944 -784 0
FLAG 800 -832 soc2
FLAG 784 -592 soc1
FLAG 832 -592 0
FLAG 848 -832 0
FLAG -368 -960 Vcc+
FLAG -368 -896 Vee-
FLAG -416 -960 soc2
IOPIN -416 -960 In
FLAG -336 -928 balance
IOPIN -336 -928 Out
FLAG -416 -864 soc1
IOPIN -416 -864 In
FLAG -176 -976 onctrl
IOPIN -176 -976 Out
FLAG -176 -896 0
SYMBOL sw 208 -528 R90
SYMATTR InstName S1
SYMBOL ind 400 -544 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 10m
SYMBOL cap 416 -464 R0
SYMATTR InstName C1
SYMATTR Value 10m
SYMBOL res 592 -448 R0
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 1008 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res 1072 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL voltage 368 288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 15
SYMBOL voltage 496 288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value -15
SYMBOL OpAmps\\UniversalOpAmp2 1104 -48 R0
SYMATTR InstName U1
SYMBOL res 1328 -64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 1456 -32 R0
SYMATTR InstName U2
SYMBOL cap 1536 -176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL res 1584 -304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 5k
SYMBOL res 1776 -144 R0
SYMATTR InstName R6
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 2368 -96 R0
SYMATTR InstName U4
SYMBOL OpAmps\\UniversalOpAmp2 2720 -64 R0
SYMATTR InstName U5
SYMBOL res 2064 -256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 15k
SYMBOL res 2224 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 160k
SYMBOL cap 2272 -224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 4n
SYMBOL res 2576 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 36.41k
SYMBOL res 2896 -208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res 2688 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 36.41k
SYMBOL res 2656 80 R0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL voltage 2544 16 R0
WINDOW 0 37 54 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 5.3759
SYMBOL Li-Ion 480 -512 R0
WINDOW 39 192 -26 VCenter 1
SYMATTR InstName X1
SYMATTR SpiceLine Isoc=0.022
SYMBOL res 992 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 1056 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL voltage 912 288 R90
WINDOW 0 41 72 Left 2
WINDOW 3 -119 93 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 110m
SYMBOL OpAmps\\UniversalOpAmp2 1088 320 R0
SYMATTR InstName U7
SYMBOL res 1312 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 1472 336 R0
SYMATTR InstName U9
SYMBOL cap 1552 192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL res 1600 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 5k
SYMBOL diode 304 -384 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL Li-Ion 480 -720 R0
WINDOW 39 185 -22 VCenter 1
SYMATTR InstName X2
SYMATTR SpiceLine Isoc=0.01975
SYMBOL OpAmps\\UniversalOpAmp2 2224 -624 R0
SYMATTR InstName U10
SYMBOL cap 752 -416 R0
SYMATTR InstName C5
SYMATTR Value 10n
SYMBOL OpAmps\\UniversalOpAmp1 2016 -80 M180
SYMATTR InstName U13
SYMBOL res 1760 -432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 57 57 VTop 2
SYMATTR InstName R22
SYMATTR Value 1Meg
SYMBOL voltage -816 -464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(0 220 50)
SYMBOL res -560 -512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 1
SYMBOL ind -576 -480 R0
WINDOW 0 40 29 Left 2
WINDOW 3 25 117 Left 2
SYMATTR InstName L2
SYMATTR Value 1
SYMATTR Type ind
SYMBOL ind -432 -368 R180
WINDOW 0 36 90 Left 2
WINDOW 3 -18 3 Left 2
SYMATTR InstName L3
SYMATTR Value 0.004
SYMATTR Type ind
SYMBOL diode -384 -480 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 53 60 VBottom 2
SYMATTR InstName D1
SYMBOL diode -304 -432 R180
WINDOW 0 -31 23 Left 2
WINDOW 3 -15 5 Left 2
SYMATTR InstName D3
SYMBOL diode -368 -432 R180
WINDOW 0 24 64 Left 2
WINDOW 3 34 43 Left 2
SYMATTR InstName D4
SYMBOL diode -384 -416 R270
WINDOW 0 -33 58 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D5
SYMBOL cap -272 -432 R0
SYMATTR InstName C6
SYMATTR Value 2200µ
SYMBOL res -160 -480 R0
SYMATTR InstName R26
SYMATTR Value 100
SYMBOL OpAmps\\UniversalOpAmp2 1696 -592 R0
SYMATTR InstName U3
SYMBOL voltage 256 288 R0
WINDOW 0 41 72 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value 8.35
SYMBOL res 1648 -592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R27
SYMATTR Value 13.7k
SYMBOL bv 1936 -512 R0
SYMATTR InstName B1
SYMATTR Value V=if(V(control)>8, V(vctrl),V(Ictrl))
SYMBOL sw 432 -784 R0
SYMATTR InstName S2
SYMBOL voltage -672 -896 R90
WINDOW 0 41 72 Left 2
WINDOW 3 -25 146 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 10m
SYMBOL OpAmps\\UniversalOpAmp2 -576 -864 R0
SYMATTR InstName U6
SYMBOL res 944 -560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 1Meg
SYMBOL sw 864 -544 R90
SYMATTR InstName S3
SYMATTR Value SW2
SYMBOL res 960 -800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 1Meg
SYMBOL sw 880 -784 R90
SYMATTR InstName S4
SYMATTR Value SW2
SYMBOL OpAmps\\UniversalOpAmp2 -368 -928 R0
SYMATTR InstName U8
SYMBOL bv -176 -992 R0
SYMATTR InstName B2
SYMATTR Value V=(V(Vshunt)+ABS(V(balance)))
TEXT 88 144 Left 2 !.tran 100m
TEXT 80 16 Left 2 !.model SW SW(Ron=1, Roff=100Meg, Vt=4.2, Vh=0.05)
TEXT 2408 -280 Left 2 !.ic V(v3)=5
TEXT 80 -16 Left 2 !.options gmin=1e-5 abstol=1n reltol=0.1
TEXT 624 -472 Left 2 ;3V inicial
TEXT 624 -656 Left 2 ;2.7V inicial
TEXT 88 -160 Left 2 !.ic I(L1)=0
TEXT 88 48 Left 2 !.model SW2 SW(Ron=1, Roff=100Meg, Vt=1V, Vh=0.05)
TEXT -584 -280 Left 2 !K1 L2 L3 1
TEXT -624 -608 Left 2 ;Conversor de 220V AC - 12V DC
TEXT 2112 -320 Left 2 ;Onda triangular de 0-3V
TEXT 1128 144 Left 2 ;Controlador CC
TEXT 1128 -192 Left 2 ;Controlador CV
TEXT 248 -600 Left 2 ;Buck
TEXT 832 -704 Left 2 ;Proteccion de sobrecarga
TEXT 824 -408 Left 2 ;Punto de medida de I
TEXT 2128 -752 Left 2 ;Comparador para PWM
TEXT 1552 -728 Left 2 ;Selector de Modo CC/CV
TEXT -616 -1088 Left 2 ;Apagado automatico
