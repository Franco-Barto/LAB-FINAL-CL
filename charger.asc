Version 4.1
SHEET 1 2972 680
WIRE 1296 -656 1264 -656
WIRE 1440 -640 1360 -640
WIRE 1296 -624 1232 -624
WIRE 1712 -608 1616 -608
WIRE 1792 -608 1776 -608
WIRE 1840 -608 1792 -608
WIRE 1840 -592 1840 -608
WIRE 1904 -592 1840 -592
WIRE 1936 -592 1904 -592
WIRE 1904 -576 1904 -592
WIRE 1696 -464 1600 -464
WIRE 1840 -464 1840 -592
WIRE 1840 -464 1776 -464
WIRE 112 -336 32 -336
WIRE 288 -336 112 -336
WIRE 464 -336 368 -336
WIRE 480 -336 464 -336
WIRE 608 -336 560 -336
WIRE 784 -336 608 -336
WIRE 1200 -304 1200 -320
WIRE 1216 -304 1200 -304
WIRE 304 -288 288 -288
WIRE 368 -288 352 -288
WIRE 1488 -288 1392 -288
WIRE 1600 -288 1568 -288
WIRE 32 -272 32 -336
WIRE 288 -272 288 -288
WIRE 288 -272 256 -272
WIRE 608 -272 608 -336
WIRE 1216 -272 1200 -272
WIRE 464 -256 464 -336
WIRE 256 -240 256 -272
WIRE 736 -240 736 -272
WIRE 784 -240 784 -256
WIRE 832 -240 784 -240
WIRE 1968 -240 1792 -240
WIRE 2112 -240 2048 -240
WIRE 2128 -240 2112 -240
WIRE 1200 -224 1200 -272
WIRE 2480 -224 2272 -224
WIRE 2272 -208 2272 -224
WIRE 2800 -192 2672 -192
WIRE 1392 -160 1392 -288
WIRE 1472 -160 1392 -160
WIRE 1600 -160 1600 -288
WIRE 1600 -160 1536 -160
WIRE 32 -128 32 -192
WIRE 464 -128 464 -192
WIRE 464 -128 32 -128
WIRE 496 -128 464 -128
WIRE 608 -128 608 -208
WIRE 608 -128 496 -128
WIRE 784 -128 784 -160
WIRE 784 -128 608 -128
WIRE 1792 -128 1792 -240
WIRE 496 -112 496 -128
WIRE 2208 -112 2208 -208
WIRE 2336 -112 2208 -112
WIRE 1968 -96 1968 -240
WIRE 1984 -96 1968 -96
WIRE 2480 -96 2480 -224
WIRE 2480 -96 2400 -96
WIRE 2672 -96 2672 -192
WIRE 2672 -96 2560 -96
WIRE 1056 -80 992 -80
WIRE 2128 -80 2128 -240
WIRE 2128 -80 2048 -80
WIRE 2208 -80 2208 -112
WIRE 2336 -80 2320 -80
WIRE 2672 -80 2672 -96
WIRE 2688 -80 2672 -80
WIRE 1056 -64 1056 -80
WIRE 1072 -64 1056 -64
WIRE 1984 -64 1968 -64
WIRE 2880 -64 2880 -192
WIRE 2880 -64 2752 -64
WIRE 1232 -48 1136 -48
WIRE 1392 -48 1392 -160
WIRE 1392 -48 1312 -48
WIRE 1424 -48 1392 -48
WIRE 2688 -48 2672 -48
WIRE 1072 -32 1056 -32
WIRE 1600 -32 1600 -160
WIRE 1600 -32 1488 -32
WIRE 2320 -32 2320 -80
WIRE 1424 -16 1392 -16
WIRE 1968 -16 1968 -64
WIRE 2592 0 2544 0
WIRE 2672 0 2672 -48
WIRE 976 16 912 16
WIRE 1056 16 1056 -32
WIRE 2544 32 2544 0
WIRE 1392 48 1392 -16
WIRE 1792 64 1792 -48
WIRE 2480 64 2480 -96
WIRE 2480 64 1792 64
WIRE 1504 80 1408 80
WIRE 1616 80 1584 80
WIRE 2672 96 2672 0
WIRE 1408 208 1408 80
WIRE 1488 208 1408 208
WIRE 1616 208 1616 80
WIRE 1616 208 1552 208
WIRE 1040 288 976 288
WIRE 1040 304 1040 288
WIRE 1056 304 1040 304
WIRE 1216 320 1120 320
WIRE 1408 320 1408 208
WIRE 1408 320 1296 320
WIRE 1440 320 1408 320
WIRE 1056 336 1040 336
WIRE 1616 336 1616 208
WIRE 1616 336 1504 336
WIRE 1440 352 1408 352
WIRE 960 384 896 384
WIRE 1040 384 1040 336
WIRE 1408 416 1408 352
FLAG 496 -112 0
FLAG 256 -240 0
FLAG 832 -240 Vshunt
IOPIN 832 -240 Out
FLAG 112 -336 Vs
FLAG 912 16 Vint
IOPIN 912 16 In
FLAG 880 -464 0
FLAG 1008 -464 0
FLAG 880 -544 Vcc+
FLAG 1008 -544 Vee-
FLAG 1104 -80 Vcc+
FLAG 1104 -16 Vee-
FLAG 832 -80 0
FLAG 608 -336 Vint
FLAG 1456 0 0
FLAG 1392 48 0
FLAG 1456 -64 Vcc+
FLAG 2016 -48 Vcc+
FLAG 2016 -112 Vee-
FLAG 2368 -128 Vcc+
FLAG 2368 -64 Vee-
FLAG 2720 -96 Vcc+
FLAG 2720 -32 Vee-
FLAG 2320 -32 0
FLAG 1968 -16 0
FLAG 2544 112 0
FLAG 2880 -64 Tri
IOPIN 2880 -64 Out
FLAG 2672 176 0
FLAG 2112 -240 v3
FLAG 1600 -32 vctrl
IOPIN 1600 -32 Out
FLAG 368 -288 PWM
IOPIN 368 -288 In
FLAG 736 -240 soc1
FLAG 896 384 Vshunt
IOPIN 896 384 In
FLAG 1088 288 Vcc+
FLAG 1088 352 Vee-
FLAG 816 288 0
FLAG 1472 368 0
FLAG 1408 416 0
FLAG 1472 304 Vcc+
FLAG 1616 336 Ictrl
IOPIN 1616 336 Out
FLAG 1248 -320 Vcc+
FLAG 1248 -256 Vee-
FLAG 1200 -224 control
IOPIN 1200 -224 In
FLAG 1200 -320 Tri
IOPIN 1200 -320 In
FLAG 1280 -288 PWM
IOPIN 1280 -288 Out
FLAG 1600 -464 Ictrl
IOPIN 1600 -464 In
FLAG 1616 -608 vctrl
IOPIN 1616 -608 In
FLAG 1936 -592 control
IOPIN 1936 -592 Out
FLAG 1776 -656 0
FLAG 1712 -416 0
FLAG 1728 -656 Vint
IOPIN 1728 -656 In
FLAG 1904 -496 0
FLAG 1328 -608 Vcc+
FLAG 1328 -672 Vee-
FLAG 1440 -640 -vint
IOPIN 1440 -640 Out
FLAG 1232 -624 Vint
IOPIN 1232 -624 In
FLAG 1264 -736 0
FLAG 1760 -416 -vint
IOPIN 1760 -416 In
SYMBOL sw 272 -336 R270
SYMATTR InstName S1
SYMATTR Value S1
SYMBOL voltage 32 -288 R0
WINDOW 123 0 0 Left 2
WINDOW 39 24 124 Left 2
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL ind 576 -352 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 10m
SYMBOL diode 480 -192 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL cap 592 -272 R0
SYMATTR InstName C1
SYMATTR Value 10m
SYMBOL res 768 -256 R0
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 1008 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res 1072 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL voltage 928 -80 R90
WINDOW 0 41 72 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 4.2V
SYMBOL voltage 880 -560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 15
SYMBOL voltage 1008 -560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value -15
SYMBOL OpAmps\\UniversalOpAmp2 1104 -48 R0
SYMATTR InstName U1
SYMBOL res 1328 -64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 1456 -32 R0
SYMATTR InstName U2
SYMBOL cap 1536 -176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL res 1584 -304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 5k
SYMBOL res 1776 -144 R0
SYMATTR InstName R6
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 2016 -80 M180
SYMATTR InstName U3
SYMBOL OpAmps\\UniversalOpAmp2 2368 -96 R0
SYMATTR InstName U4
SYMBOL OpAmps\\UniversalOpAmp2 2720 -64 R0
SYMATTR InstName U5
SYMBOL res 2064 -256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 15k
SYMBOL res 2224 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 160k
SYMBOL cap 2272 -224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 4n
SYMBOL res 2576 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 36.41k
SYMBOL res 2896 -208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res 2688 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 36.41k
SYMBOL res 2656 80 R0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL voltage 2544 16 R0
WINDOW 0 37 54 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 5.3759
SYMBOL Li-Ion 656 -288 R0
WINDOW 39 191 -3 VCenter 1
SYMATTR InstName X1
SYMATTR SpiceLine Isoc=0.5
SYMBOL res 992 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 1056 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL voltage 912 288 R90
WINDOW 0 41 72 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 100m
SYMBOL OpAmps\\UniversalOpAmp2 1088 320 R0
SYMATTR InstName U7
SYMBOL res 1312 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 1472 336 R0
SYMATTR InstName U9
SYMBOL cap 1552 192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL res 1600 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 1248 -288 R0
SYMATTR InstName U8
SYMBOL sw 1808 -608 R90
SYMATTR InstName S2
SYMATTR Value SW2
SYMBOL sw 1680 -464 R270
SYMATTR InstName S3
SYMATTR Value SW2
SYMBOL res 1888 -592 R0
SYMATTR InstName R17
SYMATTR Value 1Meg
SYMBOL OpAmps\\UniversalOpAmp2 1328 -640 M180
SYMATTR InstName U6
SYMBOL voltage 1264 -640 R180
WINDOW 0 24 96 Left 2
WINDOW 3 49 43 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 4.2
TEXT 80 248 Left 2 !.tran 10
TEXT 272 200 Left 2 !.ic V(Vint)=4.1V
TEXT 88 296 Left 2 !.param Tp=100u dt=36.5u
TEXT 88 144 Left 2 !.model S1 SW(Ron=1, Roff=100Meg, Vt=1, Vh=0.1)
TEXT 2200 -280 Left 2 !.ic V(v3)=5
TEXT 72 40 Left 2 !.options gmin=1e-12 abstol=1n reltol=0.1
TEXT 1392 -848 Left 2 !.model SW2 SW(Ron=0.01 Roff=1Meg Vt=4.2 Vh=0.05)
